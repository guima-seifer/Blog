<!-- Dashboard AREA -->
<section id="table-area-section" class="" style="margin-bottom: 7rem;">
  <div class="container">

    <!-- //TODO: Criar uma especie de joystick para selecionar diferentes opções no ecrã (norte, este, oeste e sul do botao); -->
    <div id="button-grp" class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
      <div class="btn-group">
        <button type="button" class="btn btn-secondary btn-lg mb-5" style="border-radius: 50%;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fa fa-plus"  data-toggle="tooltip" data-placement="top" title="Ações"></i>
        </button>
        <div class="dropdown-menu dropdown-menu-right bg-white">
          <button data-toggle="modal" data-target="#addPostModal" class="dropdown-item text-dark" type="button">Adicionar Postagem</button>
          <button class="dropdown-item text-dark" type="button " data-toggle="modal" data-target="#addCategoryModal">Adicionar Categoria</button>
        </div>
      </div>
      <!-- <a href="posts/add" class="btn btn-primary btn-block" data-toggle="modal" data-target="#addPostModal"><i class="fa fa-plus"></i> Adicionar Postagem</a> -->
    </div>
    <div id="board-section" class="row">
      <div id="card-row" class="col-sm-12 col-md-4 col-lg-4">
        <!-- <div class="row"> -->
          <%if(posts.length > 0){%>
            <% for(var i=posts.length-1; 0<=i; i--){ %>
              <div id="card-grid" name="card-grid" class="col-sm-12 col-md-12 col-lg-12">
                <!-- //TODO:PASSAR ISTO PARA DFLEX TÁ SO FEIO COM UMA TABELA LOL -->
                <% moment.locale('pt_PT')%>
                <div id="dash-card" class="card mb-4" style=" border-color: #93B8C2; box-shadow: 5px 5px 3px grey;">
                  <div id="carets" onclick="jumbotronRender(<%= i %>);" onmouseup="toggleVisibility(<%= i %>)" class="card-header bg-primary text-white my-0 py-0">
                    <div class="d-flex flex-row justify-content-between">
                      <div class="pt-2">
                        <p>
                          <div class="card-title text-white">
                            <h6 style="text-shadow: 1px 1px 3px black;">
                              <b>
                                <form action="/post/:_id/fave" method="get">
                                  <i id="favicon<%=i%>" onclick="favPost(<%= i %>)" class="fa fa-star float-left mr-1" aria-hidden="true"></i>
                                </form>
                                <span id="postTitle<%=i%>"><%= posts[i].title %></span>
                              </b>
                            </h6>
                            <a id="postCategory" style="text-decoration: none;" class="text-white" href="#">
                              <span id="postCategory<%=i%>" ><%= posts[i].category %></span>
                            </a>
                          </div>
                        </p>
                      </div>
                    </div>

                    <div class="d-flex flex-row justify-content-between">
                      <div>
                        <div class="">
                          <p>
                            <span id="postDate<%=i%>" class="text-light ml-auto"><%= moment(posts[i].date).format('DD MMMM YYYY') %></span>
                          </p>
                        </div>
                      </div>
                      <div id="postAuthor<%=i%>">
                        <a class="text-light float-right" href="/users/<%=posts[i].user.url_name%>" style="text-decoration: none;">
                            <span ><%= posts[i].user.name %></span>
                        </a>
                      </div>
                    </div>
                    <!-- <div class="text-center m-0 p-0">
                    <a><i class="fa fa-angle-double-down"></i></a>
                  </div> -->
                </div>
                <div id="postBody<%=i%>" style="display: none;">
                  <div class="card-block">
                    <div class="d-flex flex-row justify-content-start mx-5 my-3">
                      <div id="pstBody<%=i%>" class="">
                        <%- posts[i].body %>
                      </div>
                    </div>
                    <%if (posts[i].files.length > 0){%>
                      <hr/>
                      <div class="d-flex flex-row justify-content-start mx-5 my-3">
                        <label for="attached">Ficheiros anexados:</label>
                        <div class="" id="attached">
                          <ul>
                            <%for(let j = 0; j < posts[i].files.length; j++){%>
                              <li>
                                <%= posts[i].files[j]%>
                              </li>
                              <%}%>
                            </ul>
                          </div>
                        </div>
                        <%}%>
                      </div>

                    </div>
                    <div class="card-footer">
                      <div class="d-flex flex-row justify-content-between">
                        <small class="d-block mr-3 text-muted">
                            <%= posts[i].comments.length %> Comentários
                        </small>
                        <!-- TODO: Se for o autor pode editar a publicação -->
                        <div class="d-block mr-3">
                          <a data-toggle="tooltip" data-placement="bottom" title="Editar" href="/posts/<%= posts[i]._id%>" class="text-muted mt-1" style="text-decoration: none;"><i class="fa fa-pencil"></i></a>
                        </div>
                        <div class="d-block mr-3">
                          <a data-toggle="tooltip" data-placement="bottom" title="Partilhar" href="/posts/<%= posts[i]._id%>/share" class="text-muted mt-1" style="text-decoration: none;"><i class="fa fa-share-alt"></i></a>
                        </div>
                        <div class="d-block mr-3">
                          <a data-toggle="tooltip" data-placement="bottom" title="Comentar" href="/posts/<%= posts[i]._id %>" class="text-muted mt-1" style="text-decoration: none;"><i class="fa fa-comment-o"></i></a>
                        </div>
                      </div>
                    </div>
                    <div style="display: none;" id="postComments<%=i%>">
                        <% if(posts[i].comments.length > 0){%>
                        <%for(let k = 0; k < posts[i].comments.length; k++){%>
                        <%if(posts[i].comments[k].commentUser !== undefined){%>
                        <small><%= moment(posts[i].comments[k].commentDate).format('DD MMMM YYYY h:mm:ss a') %></small>

                        <p>
                            <%= posts[i].comments[k].commentBody%>
                        </p>
                        <p class="text-muted">
                            <a style="text-decoration:none !important;" href="/users/<%=posts[i].comments[k].commentUser.url_name%>"><%= posts[i].comments[k].commentUser.name%></a>
                        </p>
                        <hr/>
                        <%}%>
                        <%}%>
                        <%}%>
                    </div>
                  </div>
                </div>
                <%} %>
                <%}else{%>
                  <div class="text-center mt-3">
                    <p>Não foram adicionados nenhums posts :-O</p>
                  </div>
                  <%}%>
                <!-- </div> -->
              </div>

              <div id="jumbotron" class="col-xs-0 col-sm-0 col-md-8 col-lg-8">
                <div class="jumbotron m-2 p-3 bg-white">
                  <h1 id="jumboTitle" class="display-5"> Selecione algum conteúdo</h1>
                  <p id="jumboInfo"></p>
                  <hr class="my-4 mx-0 px-0">
                  <p id="jumboBody" class="">Selecione um item para poder visualizar</p>
                  <hr class="my-4 bg-light">
                  <!-- Para os comentários -->
                  <p id="jumboFooter" class="">Comentários:</p>
                  <p id="jumboComments"></p>
                </div>
              </div>
            </div>
          </section>

          <script type="text/javascript">
          function favPost(id) {
            console.log(id);
            var favicon = $('#favicon' + id);
            favicon.css('color', '#FFFF00');
          };

          function toggleVisibility(id) {
            if ($('[id$=card-row]').hasClass('col-lg-12')) {
              $('#postBody' + id).toggle('slow');
            } else {
              $('#postBody' + id).css('display', 'none');
              $('#jumbotron').css('display', 'block');
            }
          };

          function jumbotronRender(aux, title) {
            var postBody = $('#pstBody' + aux).html();
            var postTitle = $('#postTitle' + aux).html();
            var postCategory = $('#postCategory' + aux).html();
            var postDate = $('#postDate' + aux).html();
            var postAuthor = $('#postAuthor' + aux).html();
            postAuthor = postAuthor.replace('text-light','');
            console.dir(postAuthor);
            let postComments = $('#postComments' + aux).html();
            document.getElementById('jumboBody').innerHTML = postBody;
            document.getElementById('jumboTitle').innerHTML = postTitle;
            document.getElementById('jumboInfo').innerHTML = '<div class="d-block">' +
            '<b class="text-secondary">' +
            postCategory + '</b></div>' +
            '<div class="d-inline">' + postDate + '</div>' + '<div class="d-inline float-right"> ' +
            postAuthor + ' </div>';
            $("#jumboComments").html(postComments);
          };

          function changeGrid() {
            if ($('[name$=card-grid]').hasClass('col-md-12')) {
              $('[id$=card-row]').attr('class', 'col-md-12 col-lg-12 card-columns');
              $('[name$=card-grid]').attr('class', '');
              $('#jumbotron').hide();
            } else {
              $('[id$=card-row]').attr('class', 'col-md-4 col-lg-4');
              $('[name$=card-grid]').attr('class', 'col-md-12 col-lg-12');
              $('#jumbotron').show();
            }
          }

          function toggleTable() {
            document.getElementById('board-section').innerHTML =
            '<table class="table table-hover table-striped table-dark" id="tableCategories">'+
            '<thead class="">'+
            '<tr>'+
            '<th>#</th>'+
            '<th>Postagem</th>'+
            '<th>Autor</th>'+
            '<th class="text-center">Ação</th>'+
            '</tr>'+
            '</thead>'+
            '<tbody class="">'+
            '<% moment.locale('pt_PT')%>'+
            '<% for(let i=0; i < posts.length; i++){%>'+
            '<tr scope="row" class="">'+
            '<td scope="col">'+
            '<%= moment(posts[i].date).format('DD MMMM YYYY') %>'+
            '</td>'+
            '<td>'+
            '<%= posts[i].title %>'+
            '</td>'+
            '<td>'+
            '<%= posts[i].authorName %>'+
            '</td>'+
            '<td class="text-center">'+
            '<form action="/posts/delete/<%= posts[i]._id%>?_method=DELETE" method="post">'+
            '<input type="hidden" name="_method" value="DELETE">'+
            '<!--TODO: <i class="fa fa-times text-danger"></i>  Instead of input button-->'+
            '<button type="submit" name="DELETE" class="btn btn-secondary"><i class="fa fa-times"></i></button>'+
            '</form>'+
            '</td>'+
            '<%}%>'+
            '</tr>'+
            '</tbody>'+
            '</table>;';

          }
        </script>
