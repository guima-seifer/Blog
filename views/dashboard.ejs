<header id="main-header" class="pt-3 text-white" style="background-color: #236475">
  <!-- //TODO: Passar isto para navbar -->
  <div class="container">
    <div class="row">
      <div class="col-xs-4 col-sm-5 col-md-4 col-lg-2">
        <h1>
          <i class="fa fa-tachometer"></i> Painel
        </h1>
      </div>
      <div class="col-xs-2 col-sm-4 col-md-4 col-lg-4 mt-1">
        <!-- TODO: Ao clicar nas notificações é feito um pedido para gerar as X novas notificações que tem (comentários/ edits etc) na dashboard -->
        <button type="button" class="btn btn-primary">
          Notificações <span class="badge badge-light"><%= posts.length %></span>
        </button>
      </div>
      <div class="col-xs-1 col-sm-2 col-md-2 col-lg-2 my-1 offset-xs-6 offset-sm-0 offset-md-2 offset-lg-4">
        <button class="btn btn-primary" onclick="changeGrid();" style="border-radius: 50%;">
          <i  data-toggle="tooltip" data-placement="bottom" title="Alterar Disposição do Painel" class="fa fa-columns" aria-hidden="true"></i>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- ACTIONS -->
<section id="action" class="py-4 mb-4">
  <div class="container">
    <%-include('./partials/_msg')%>
  </div>
</section>

<!-- Dashboard AREA -->
<section id="table-area-section" class="" style="margin-bottom: 7rem;">
  <div class="container">

    <!-- //TODO: Criar uma especie de joystick para selecionar diferentes opções no ecrã (norte, este, oeste e sul do botao); -->
    <div id="button-grp" class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
      <div class="btn-group">
        <button type="button" class="btn btn-secondary btn-lg mb-5" style="border-radius: 50%;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fa fa-plus"  data-toggle="tooltip" data-placement="top" title="Ações"></i>
        </button>
        <div class="dropdown-menu dropdown-menu-right bg-white">
          <button data-toggle="modal" data-target="#addPostModal" class="dropdown-item text-dark" type="button">Adicionar Postagem</button>
          <button class="dropdown-item text-dark" type="button " data-toggle="modal" data-target="#addCategoryModal">Adicionar Categoria</button>
        </div>
      </div>
      <!-- <a href="posts/add" class="btn btn-primary btn-block" data-toggle="modal" data-target="#addPostModal"><i class="fa fa-plus"></i> Adicionar Postagem</a> -->
    </div>
    <div class="row">
      <div id="card-row" class="col-sm-12 col-md-12 col-lg-12">
        <div class="row">
          <%if(posts.length > 0){%>
            <% for(var i=posts.length-1; 0<=i; i--){ %>
              <div id="card-grid" name="card-grid" class="col-sm-12 col-md-12 col-lg-6">
                <!-- //TODO:PASSAR ISTO PARA DFLEX TÁ SO FEIO COM UMA TABELA LOL -->
                <% moment.locale('pt_PT')%>
                  <div class="card mb-4" style=" border-color: #93B8C2; box-shadow: 5px 7px 5px grey;">
                    <div id="carets" onclick="jumbotronRender(<%=i %>, <%=posts[i]%>)" onmouseup="toggleVisibility(<%= i %>)" class="card-header bg-primary text-white my-0 py-0">

                      <div class="d-flex flex-row justify-content-between">
                        <div class="pt-2">
                          <p>
                            <div class="card-title text-white">
                              <h6 style="text-shadow: 1px 1px 3px black;"><b><i class="fa fa-star-o float-left mr-1" aria-hidden="true"> </i> <%= posts[i].title %></b></h6>
                              <a style="text-decoration: none;" class="text-white" href="#">
                                <%= posts[i].category %>
                              </a>
                            </div>
                          </p>
                        </div>
                      </div>

                      <div class="d-flex flex-row justify-content-between">
                        <div>
                          <div class="">
                            <p>
                              <span class="text-light ml-auto"><%= moment(posts[i].date).format('DD MMMM YYYY') %></span>
                            </p>
                          </div>
                        </div>
                        <div>
                          <a class="text-light  float-right" href="#" style="text-decoration: none;">
                            <%= posts[i].authorName %>
                          </a>
                        </div>
                      </div>
                      <!-- <div class="text-center m-0 p-0">
                    <a><i class="fa fa-angle-double-down"></i></a>
                  </div> -->
                    </div>
                    <div id="postBody<%=i%>" style="display: none;">
                      <div class="card-block">
                        <div class="d-flex flex-row justify-content-start mx-5 my-3">
                          <div class="">
                            <%- posts[i].body %>
                          </div>
                        </div>
                        <%if (posts[i].files.length > 0){%>
                          <hr/>
                          <div class="d-flex flex-row justify-content-start mx-5 my-3">
                            <label for="attached">Ficheiros anexados:</label>
                            <div class="" id="attached">
                              <ul>
                                <%for(let j = 0; j < posts[i].files.length; j++){%>
                                  <li>
                                    <%= posts[i].files[j]%>
                                  </li>
                                  <%}%>
                              </ul>
                            </div>
                          </div>
                          <%}%>
                      </div>

                    </div>
                    <div class="card-footer">
                      <div class="d-flex flex-row justify-content-between">
                        <!-- TODO: Se for o autor pode editar a publicação -->
                        <div class="d-block">
                          <a href="/posts/edit/<%= posts[i]._id%>" class="text-muted mt-1" style="text-decoration: none;"><i class="fa fa-angle-double-right"></i> Editar</a>
                        </div>
                        <div class="d-block">
                          <a href="/posts/<%= posts[i]._id%>/share" class="text-muted mt-1" style="text-decoration: none;"><i class="fa fa-share-alt"></i> Partilhar</a>
                        </div>
                        <div class="d-block">
                          <a href="/posts/<%= posts[i]._id %>" class="text-muted mt-1" style="text-decoration: none;"><i class="fa fa-angle-double-right"></i> Comentar</a>
                        </div>
                      </div>
                    </div>
                  </div>
              </div>
              <%} %>
                <%}else{%>
                  <div class="text-center mt-3">
                    <p>Não foram adicionados nenhums posts :-O</p>
                  </div>
                  <%}%>
        </div>
      </div>

      <div id="jumbotron" class="col-sm-6 col-md-6 col-lg-6" style="display: none;">
        <div class="jumbotron">
          <h1 id="jumbotitle" class="display-3">Hello, world!</h1>
          <p class="lead">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
          <hr class="my-4">
          <p>It uses utility classes for typography and spacing to space content out within the larger container.</p>
          <p class="lead">
            <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
          </p>
        </div>
      </div>
    </div>
</section>

<!-- The scroll to top feature -->

<div class="scroll-top-wrapper">
  <span class="scroll-top-inner">
              <i class="fa fa-2x fa-arrow-circle-up"></i>
            </span>
</div>

<!-- MODALS (ADD POST; ADD CATEGORY)  ADICIONAR NO FUTURO-->
<div class="modal fade" id="addPostModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="addPostModalLabel">Adicionar Postagem</h5>
        <button class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="/posts/add" class="mx-3 my-3" enctype="multipart/form-data">
          <div class="form-group">
            <label for="title" class="form-control-label">Título</label>
            <input type="text" class="form-control" name="title" id="title" required>
          </div>
          <div class="form-group">
            <label for="category" class="form-control-label">Categoria</label>
            <select name="category" class="form-control">
                        <option value=""></option>
                        <%for(let i = 0; i < categories.length; i++){%>
                          <option value="<%= categories[i].name%>"><%= categories[i].name%></option>
                          <%}%>
                        </select>
          </div>
          <div class="form-group bg-faded p-3">
            <label for="file">Anexar ficheiros ao post</label>
            <input type="file" name="filetoupload" value="" class="form-control-file" id="file" multiple>
            <small id="fileHelp" class="form-text text-muted">Tamanho máx 3MB</small>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" checked name="checkComments" id="checkComments">
            <label class="form-check-label" for="defaultCheck1">
                          Permitir comentários
                        </label>
          </div>

          <div class="form-group">
            <label for="body">Texto</label>
            <textarea name="textarea" class="form-control" rows="3" required></textarea>
          </div>
      </div>
      <%
                    var d = new Date();
                    var data = d.getUTCDate()
                    %>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <button class="btn btn-primary" value="">Adicionar Postagem</button>
        </div>
        </form>

    </div>
  </div>
</div>

<!-- MODALS (ADD CATEGORY)  -->
<div class="modal fade" id="addCategoryModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="addPostModalLabel">Adicionar Categoria</h5>
        <button class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="/categories/add">
          <div class="form-group">
            <label for="title" class="form-control-label">Nome da nova categoria</label>
            <input type="text" class="form-control" name="title" id="title" placeholder="Nome">
          </div>
          <div class="modal-footer">
            <button class="btn btn-danger" data-dismiss="modal">Fechar</button>
            <input class="btn btn-primary" type="submit" value="Adicionar categoria" />
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  var button = document.getElementById('carets'); // Assumes element with id='button'

  function toggleVisibility(id) {
    if ($('[id$=card-row]').hasClass('col-md-12')) {
      $('#postBody' + id).toggle('slow');
    } else {
      $('#postBody' + id).css('display', 'none');
      $('#jumbotron').css('display', 'block');
    }
  };

  function jumbotronRender(i) {
    console.log(i);

    // $('#jumbotron').html(posts[i]);
  }

  // function togglediv(i) {
  //   var div = document.getElementById('postBody' + i);
  //   if (div.style.display !== 'none') {
  //     div.style.display = 'none';
  //   } else {
  //     div.style.display = 'block';
  //   }
  // };
</script>

<script type="text/javascript">
  function changeGrid() {
    if ($('[name$=card-grid]').hasClass('col-md-12')) {
      $('[id$=card-row]').attr('class', 'col-md-12 col-lg-12');
      $('[name$=card-grid]').attr('class', 'col-md-6 col-lg-6');
      $('#jumbotron').hide();
    } else {
      $('[id$=card-row]').attr('class', 'col-md-6 col-lg-6');
      $('[name$=card-grid]').attr('class', 'col-md-12 col-lg-12');
      $('#jumbotron').show();
    }
  }
</script>

<!-- TODO: este script só interessa se o modal estiver funcional...  -->
<script src="https://cdn.ckeditor.com/4.8.0/standard/ckeditor.js"></script>
<script>
  CKEDITOR.replace('textarea');
</script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
